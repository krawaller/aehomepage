(function(){CATS.bb.ImportExportView=CATS.bb.BaseView.extend({localizeid:"importexport",category:"info",className:"viewbox",noprocess:true,events:{"focus .datafield":function(e){return setTimeout(function(){return $(e.srcElement||e.target||e.currentTarget).select()},50)},"click .usebutton":"useButton","click .restorebutton":"restoreButton"},resetField:function(){return this.ui.datafield.val(JSON.stringify(CATS.school.getCurrentDB()))},initialize:function(o){_.bindAll(this,"useButton","restoreButton");this.listenTo(Backbone,"forgottool",this.setMeStraight);this.listenTo(Backbone,"learnedtool",this.setMeStraight);this.listenTo(Backbone,"updatelesson",this.setMeStraight);return this.constructor.__super__.initialize.apply(this,[o])},render:function(){this.setTitle("impexpheadline");this.setContent(CATS.cache.templates["#importexporttemplate"]);this.setUI("datafield","responsemessage","learnedopsnumber","learnedlessonsnumber");this.setMeStraight();return this},setMeStraight:function(what){if(what!=="STATUSUPDATE"){this.resetField();return this.updateCount()}},updateCount:function(){this.ui.learnedopsnumber.text(CATS.school.numberOfLearnedOps());return this.ui.learnedlessonsnumber.text(CATS.school.numberOfLearnedLessons())},useButton:function(e){var data,val;val=this.ui.datafield.val();try{data=JSON.parse(val);if(val===JSON.stringify(CATS.school.getCurrentDB())){return this.setMessage("samemsg")}else if(!(data.lessons||data.tools)){return this.setMessage("errormsg")}else{return this.updateState(data)}}catch(_error){e=_error;console.log("the ehck",e);return this.setMessage("errormsg")}},updateState:function(data){CATS.school.overwriteDB(data);this.setMessage("loadedmsg");Backbone.trigger("forgottool","STATUSUPDATE");Backbone.trigger("learnedtool","STATUSUPDATE");Backbone.trigger("updatelesson","STATUSUPDATE");Backbone.trigger("STATUSUPDATE");return this.setMeStraight()},restoreButton:function(e){this.resetField();return this.setMessage("restoremsg")},setMessage:function(msgid){var me;this.ui.responsemessage.setText(msgid);if(this.showingerror){clearTimeout(this.errortimeout)}else{this.showingerror=true;this.ui.responsemessage.fadeIn("fast")}me=this;return this.errortimeout=setTimeout(function(){me.showingerror=false;return me.ui.responsemessage.fadeOut("fast")},2e3)}})}).call(this);