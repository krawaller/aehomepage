(function(){CATS.bb.LessonListView=CATS.bb.BaseView.extend({tagName:"div",className:"lessonindex viewbox",localizeid:"lessonindex",category:"school",events:{"click .applessonbutton":"toAppList","click .mathlessonbutton":"toMathList"},initialize:function(o){this.constructor.__super__.initialize.apply(this,[o]);this.listenTo(Backbone,"updatelesson",this.update);return this.localizeid="lessonindex"},toAppList:function(e){this.ui.togglebox.removeClass("togglesecond");this.ui.applessonbutton.addClass("active");return this.ui.mathlessonbutton.removeClass("active")},toMathList:function(e){this.ui.togglebox.addClass("togglesecond");this.ui.applessonbutton.removeClass("active");return this.ui.mathlessonbutton.addClass("active")},render:function(){this.setContent(CATS.cache.templates["#lessonlisttemplate"]);this.setTitle("lessonlistheadline",true);this.setUI("togglebox","applessonbutton","mathlessonbutton","applessonlist","applessonintro","lessonlist","lessonintro");this.update();return this},drawList:function(){var lessondef,lessonid,lessons,list,listitems;lessons=CATS.school.lessons;listitems=[];for(lessonid in lessons){lessondef=lessons[lessonid];if(lessondef.number<=CATS.school.numberOfAppLessons){listitems.push(this.lessonLink(lessonid))}}list=$("<div class='davidlist'>"+listitems.join("")+"</div>");this.ui.applessonlist.html(list);listitems=[];for(lessonid in lessons){lessondef=lessons[lessonid];if(lessondef.number>CATS.school.numberOfAppLessons){listitems.push(this.lessonLink(lessonid))}}list=$("<div class='davidlist'>"+listitems.join("")+"</div>");return this.ui.lessonlist.html(list)},update:function(){var count,lang,str;this.drawList();lang=CATS.settings.lang;count=CATS.school.numberOfLearnedLessonsPerKind();str="lessonintro"+function(){if(count.applessonstotal-count.applessonslearned){return"notapp"}else{switch(count.mathlessonstotal-count.mathlessonslearned){case 0:return"all";case 1:return"allbutone";case count.mathlessonstotal:return"none";default:return"some"}}}();this.ui.lessonintro.setText(str);this.ui.lessonintro.html(this.ui.lessonintro.html().replace("%FINISHED",CATS.texts.numberStr(count.mathlessonslearned,lang)));this.ui.lessonintro.html(this.ui.lessonintro.html().replace("%NUM",CATS.texts.numberStr(count.mathlessonstotal,lang)));str="applessonintro"+function(){switch(count.applessonstotal-count.applessonslearned){case 0:return"all"+(count.mathlessonslearned?"":"nonmath");case 1:return"allbutone";case count.applessonstotal:return"none";default:return"some"}}();this.ui.applessonintro.setText(str);this.ui.applessonintro.html(this.ui.applessonintro.html().replace("%FINISHED",CATS.texts.numberStr(count.applessonslearned,lang)));this.ui.applessonintro.html(this.ui.applessonintro.html().replace("%NUM",CATS.texts.numberStr(count.applessonstotal,lang)));if(count.applessonstotal-count.applessonslearned===0){return this.toMathList()}}})}).call(this);