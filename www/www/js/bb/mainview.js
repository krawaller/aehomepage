(function(){CATS.bb.MainView=CATS.bb.BaseView.extend({tagName:"div",className:"main",template:$("#mainviewtemplate").html(),localizeid:"main",events:{"click .externallink":"externalLink","click .btn-group[data-toggle='buttons-radio']":"radioButtons","click .domissionbutton":"doMission","click .undomissionbutton":"undoMission","click .toggleboxfirstbutton":"toggleBoxAdd","click .toggleboxsecondbutton":"toggleBoxRemove"},toggleBoxAdd:function(e){console.log("Toggling to second");return $(e.srcElement||e.target).closest(".togglebox").addClass("togglesecond")},toggleBoxRemove:function(e){console.log("Toggling back to first");return $(e.srcElement||e.target).closest(".togglebox").removeClass("togglesecond")},doMission:function(e){var mission,src;src=$(e.srcElement||e.target).closest("button");mission=src.attr("data-mission");return CATS.school.doMission(mission)},undoMission:function(e){var mission,src;src=$(e.srcElement||e.target).closest("button");mission=src.attr("data-mission");return CATS.school.undoMission(mission)},externalLink:function(e){},radioButtons:function(e){var btngroup,dataname,hidden,src,val;src=$(e.srcElement||e.target).closest("button");val=src.val();btngroup=src.closest(".btn-group");dataname=btngroup.attr("data-name");hidden=btngroup.prev();hidden.val(val);btngroup.find(".active").removeClass("active");src.addClass("active");return btngroup.trigger("radiobtnselect",{val:val,dataname:dataname})},updateTextReport:function(){return $("body")[CATS.settings.textreportmode==="yes"?"addClass":"removeClass"]("textreportmode")},focusTextField:function(){return $("body").addClass("focusedtext").removeClass("nofocus")},blurTextField:function(){return $("body").addClass("nofocus").removeClass("focusedtext")},initialize:function(o){var me;this.updateDimensionsDo=_.bind(this.updateDimensionsDo,this);this.updateDimensions=_.bind(this.updateDimensions,this);this.listenTo(Backbone,"settextreportmode",this.updateTextReport);this.listenTo(Backbone,"focusTextField",this.focusTextField);this.listenTo(Backbone,"blurTextField",this.blurTextField);me=this;this.prepareData(function(){me.render();$("body").prepend(me.el);return setTimeout(function(){return $("body").addClass("loaded")},800)});return this.constructor.__super__.initialize.apply(this,[o])},prepareData:function(callback){var lang,_i,_len,_ref;CATS.math.preprocessToolDefs(CATS.math);CATS.math.simplifiers=CATS.math.gatherSimplifiers(CATS.math);CATS.math.decimalifiers=CATS.math.gatherDecimalifiers(CATS.math);CATS.math.desperates=CATS.math.gatherDesperates(CATS.math);CATS.texts.wordIndex={};CATS.texts.toolIndex={};CATS.texts.infoIndex={};CATS.math.count=CATS.texts.totalToolCount();_ref=["sv","en"];for(_i=0,_len=_ref.length;_i<_len;_i++){lang=_ref[_i];CATS.texts.wordIndex[lang]=CATS.texts.makeWordIndex(lang);CATS.texts.toolIndex[lang]=CATS.texts.makeToolIndex(lang);CATS.texts.infoIndex[lang]=CATS.texts.makeInfoIndex(lang)}CATS.texts.generateToolTagIndex();CATS.texts.generateAllToolLists();if(callback){return callback()}},render:function(){this.listenTo(Backbone,"setlang",this.render2);return this.$el.append((new CATS.bb.LanguageSelectView).el)},addRoot:function(name,constr,active){var r;r=new CATS.bb.RootView;r.rootMe(name);r.$el.addClass("mainnavsection "+name+"section");if(active){r.$el.addClass("active")}r.setBottomView(new constr);return this.ui.wrapper.append(r.el)},render2:function(){this.getDimensions();this.decideSize();this.decideOrientation();if(CATS.ondevice){$(window).on("orientationchange",_.bind(function(){this.getDimensions();return this.decideOrientation()},this))}else{$(window).resize(this.updateDimensions)}this.$el.html(this.template);this.setUI("wrapper","controlpanelsection","homesection","modalsection","leftsection","toursection","parsersection","buttoncalc","calcsection","schoolrootsection","glossarysection","toolboxsection");this.ui.controlpanelsection.append((new CATS.bb.ControlpanelView).render().el);this.addRoot("calc",CATS.bb.ParserView,true);this.addRoot("glossary",CATS.bb.WordIndexView);this.addRoot("toolbox",CATS.bb.ToolIndexView);this.addRoot("schoolroot",CATS.bb.LessonListView);this.addRoot("home",CATS.bb.InfoTabView);this.$el.show();this.updateTextReport();return this},updateDimensions:function(){clearTimeout(this.dimtime);return this.dimtime=setTimeout(this.updateDimensionsDo,100)},updateDimensionsDo:function(){clearTimeout(this.dimtime);this.getDimensions();this.decideSize();return this.decideOrientation()},getDimensions:function(){CATS.height=$(document).height();return CATS.width=$(document).width()},decideSize:function(){var size;size=CATS.width<710||CATS.height<390?"phone":"large";CATS.size=size;return $("body").removeClass("phone").removeClass("large").addClass(size)},decideOrientation:function(){var orientation;orientation=CATS.height>CATS.width?"portrait":"landscape";CATS.orientation=orientation;return $("body").removeClass("portrait").removeClass("landscape").addClass(orientation)}})}).call(this);