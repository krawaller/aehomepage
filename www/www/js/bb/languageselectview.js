(function(){CATS.bb.LanguageSelectView=CATS.bb.BaseView.extend({template:$("#languageselectviewtemplate").html(),tagName:"div",localizeid:"languageselect",className:"languageselect davidmodalcontent",events:{"click .gbflag":"setEnglish","click .seflag":"setSwedish"},setEnglish:function(){return this.setLang("en",true)},setSwedish:function(){return this.setLang("sv",true)},initialize:function(o){var qstrlang,_ref,_ref1,_ref2;this.constructor.__super__.initialize.apply(this,[o]);qstrlang=(_ref=window.location)!=null?(_ref1=_ref.href)!=null?_ref1.match(/.*langu?a?g?e?=([^#]*)#?/):void 0:void 0;if(qstrlang&&qstrlang.length===2&&((_ref2=qstrlang[1])==="sv"||_ref2==="en")){return this.setLang(qstrlang[1])}else if(navigator&&navigator.language){if(navigator.language.toLowerCase().split("-").indexOf("sv")!==-1){return this.setLang("sv")}else if(navigator.language.toLowerCase().split("-").indexOf("en")!==-1){return this.setLang("en")}else{return this.render()}}else{return this.render()}},render:function(){var info;this.prepApp();this.$el.html(this.template);this.setUI("infolist");this.ui.infolist.html(function(){var _results;_results=[];for(info in CATS.texts.info){_results.push(this.infoLink(info,console.log("INFO",info)))}return _results}.call(this).join(""));return this},prepApp:function(){var _ref;return(_ref=CATS.devicesetup)!=null?typeof _ref.onAppStart==="function"?_ref.onAppStart():void 0:void 0},setLang:function(lang,choice){CATS.settings.lang=lang;this.buildTemplates(lang);this.setInfo(lang);Backbone.trigger("setlang",lang);if(!choice){this.prepApp()}this.cleanUp();return this.kill()},cleanUp:function(){$("#templates").remove();return $("#preloader").remove()},buildTemplates:function(lang){var locid,selector,tobefixed,_results;CATS.cache.templates={};tobefixed={"#wordviewtemplate":"word","#toolinfoviewtemplate":"toolinfo","#lessonviewtemplate":"lesson","#sequenceviewtemplate":"sequence","#operationviewtemplate":"operation","#mastersequenceviewtemplate":"mastersequence","#newmastersequenceviewtemplate":"newmastersequence","#toolindextemplate":"toolindex","#lessonlisttemplate":"lessonindex","#expressionsviewtemplate":"expressions","#historyviewtemplate":"historyview","#examplesviewtemplate":"examplesview","#reporttextviewtemplate":"reporttext","#mathviewtemplate":"mathview","#parsertemplate":"parser","#infotabviewtemplate":"infotab","#demonstrationtemplate":"demonstrationview","#wordindextemplate":"wordindex","#helpitemviewtemplate":"helpview","#importexporttemplate":"importexport"};_results=[];for(selector in tobefixed){locid=tobefixed[selector];_results.push(CATS.cache.templates[selector]=this.buildTemplate(selector,locid,lang))}return _results},setInfo:function(lang){var childnum,def,name,texts,_ref;childnum=lang==="en"?1:2;texts=$("#helptexts");_ref=CATS.texts.help;for(name in _ref){def=_ref[name];def.html=texts.find("#"+name+" > div:nth-child("+childnum+")").html();def.shorthtml=texts.find("#"+name+" > div:nth-child("+(childnum+2)+")").html()}return texts.remove()},buildTemplate:function(templatesel,localizeid,lang){var templ,text,textid,ui;templ=$(templatesel);ui=CATS.texts.ui[localizeid];for(textid in ui){text=ui[textid][lang];templ.find("."+textid).html(text+(localizeid==="parser"||textid.match(/button|btn|alternative|bug/)?"":this.reportLink("text",["ui",localizeid,textid,lang].join("-"))))}return templ.html()}})}).call(this);